<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Notifications | Admin — Bite Box</title>
<style>
 body{font-family:Inter,Arial;background:#f3f7f6;margin:0}
 header{background:#10332f;color:#fff;padding:12px 18px}
 main{max-width:900px;margin:18px auto;padding:12px}
 input,textarea{width:100%;padding:8px;margin-top:8px;border-radius:8px;border:1px solid #ddd}
 button{padding:8px 10px;border-radius:6px;border:none;cursor:pointer;background:#27ae60;color:#fff}
 .list{margin-top:12px}
 .item{background:#fff;padding:10px;border-radius:8px;margin-bottom:8px}
</style>
</head>
<body>
<header><strong>Notifications</strong></header>
<main>
  <h3>Send Notification</h3>
  <label>Title <input id="title"/></label>
  <label>Message <textarea id="message"></textarea></label>
  <button id="sendBtn">Send</button>
  <div class="list" id="list">Loading sent notifications…</div>
</main>

<script>
const BASE_URL = localStorage.getItem('BB_BACKEND') || 'https://bbbackend-bng2.onrender.com';
const token = localStorage.getItem('adminToken'); if(!token) location.href='admin-login.html';

document.getElementById('sendBtn').addEventListener('click', async ()=>{
  const title = document.getElementById('title').value.trim();
  const message = document.getElementById('message').value.trim();
  if(!title || !message) return alert('Add title & message');
  try {
    const res = await fetch(`${BASE_URL}/api/notify/send`, {
      method:'POST', headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},
      body: JSON.stringify({ title, message })
    });
    if(!res.ok) throw new Error('Send failed');
    alert('Notification created');
    document.getElementById('title').value=''; document.getElementById('message').value='';
    loadList();
  } catch(e){ alert('Failed'); console.error(e); }
});

async function loadList(){
  try {
    const res = await fetch(`${BASE_URL}/api/notify/list`, { headers:{ Authorization:'Bearer '+token }});
    const items = await res.json();
    const wrap = document.getElementById('list');
    if(!Array.isArray(items) || items.length===0) { wrap.innerHTML = '<div>No notifications</div>'; return; }
    wrap.innerHTML = items.map(i=>`<div class="item"><strong>${i.title}</strong><div style="color:#666">${i.message}</div><div style="font-size:12px;color:#999">${new Date(i.date).toLocaleString()}</div></div>`).join('');
  } catch(e){ console.error(e); document.getElementById('list').innerText='Failed to load'; }
}

loadList();
</script>
</body>
</html>
